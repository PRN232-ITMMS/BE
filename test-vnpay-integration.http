### VNPay Payment Integration Tests

# Test 1: Create VNPay Payment
POST https://localhost:7077/api/payments/create
Content-Type: application/json
Authorization: Bearer {{your_jwt_token}}

{
  "customerId": 1,
  "amount": 500000,
  "description": "Treatment Package Payment - VNPay Test",
  "treatmentCycleId": null,
  "appointmentId": null,
  "returnUrl": "https://localhost:3000/payment/success",
  "cancelUrl": "https://localhost:3000/payment/cancel"
}

###

# Test 2: Get Payment Status
GET https://localhost:7077/api/payments/status/{{payment_id}}
Authorization: Bearer {{your_jwt_token}}

###

# Test 3: Get Payment History for Customer
GET https://localhost:7077/api/payments/history/1?page=1&pageSize=10
Authorization: Bearer {{your_jwt_token}}

###

# Test 4: VNPay Callback (Webhook) - Simulated
POST https://localhost:7077/api/payments/vnpay/callback
Content-Type: application/x-www-form-urlencoded

vnp_Amount=50000000&vnp_BankCode=NCB&vnp_BankTranNo=VNP14357791&vnp_CardType=ATM&vnp_OrderInfo=Treatment+Package+Payment&vnp_PayDate=20240707140000&vnp_ResponseCode=00&vnp_TmnCode=DEMO&vnp_TransactionNo=14357791&vnp_TransactionStatus=00&vnp_TxnRef={{payment_id}}&vnp_SecureHashType=SHA512&vnp_SecureHash={{calculated_hash}}

###

# Test 5: Process Refund (Admin Only)
POST https://localhost:7077/api/payments/refund
Content-Type: application/json
Authorization: Bearer {{admin_jwt_token}}

{
  "paymentId": "{{payment_id}}",
  "refundAmount": 500000,
  "reason": "Customer requested refund",
  "adminUserId": "admin123"
}

###

# Test 6: VNPay Return URL Validation
GET https://localhost:7077/api/payments/vnpay/return?vnp_Amount=50000000&vnp_BankCode=NCB&vnp_BankTranNo=VNP14357791&vnp_CardType=ATM&vnp_OrderInfo=Treatment+Package+Payment&vnp_PayDate=20240707140000&vnp_ResponseCode=00&vnp_TmnCode=DEMO&vnp_TransactionNo=14357791&vnp_TransactionStatus=00&vnp_TxnRef={{payment_id}}&vnp_SecureHashType=SHA512&vnp_SecureHash={{calculated_hash}}

###

# Test Configuration - Update appsettings.json with real VNPay credentials
# "PaymentGateways": {
#   "VNPay": {
#     "TmnCode": "YOUR_TMN_CODE",
#     "HashSecret": "YOUR_HASH_SECRET", 
#     "PaymentUrl": "https://sandbox.vnpayment.vn/paymentv2/vpcpay.html",
#     "CallbackUrl": "https://yourdomain.com/api/payments/vnpay/callback",
#     "ReturnUrl": "https://yourfrontend.com/payment/result"
#   }
# }
